{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/js/App.ts","webpack:///./src/js/Ctx.ts","webpack:///./src/js/Flappy.ts","webpack:///./src/js/Game.ts","webpack:///./src/js/NeuralNet.ts","webpack:///./src/js/Resource.ts"],"names":["createGame","TextPosition","Ctx","constructor","options","w","h","size","_queue","showFps","text","textCoordinates","TopLeft","Middle","init","loop","canvas","document","createElement","width","height","ctx","body","appendChild","getContext","font","queueText","fps","toFixed","now","req","requestAnimationFrame","time","clearRect","filter","alive","forEach","func","queue","push","i","findIndex","v","console","error","splice","position","remove","padv","padh","fillText","PIPE_GAP","PIPE_MARGIN","PIPE_SPEED","BIRD_AMOUNT","BIRD_GRAVITY","BIRD_FORCE","DEFAULT_FPS","NETWORK_INPUTS","NETWORK_OUTPUTS","NETWORK_STRUCTURE","timeouts","messageName","setZeroTimeout","fn","window","postMessage","handleMessage","event","source","data","stopPropagation","length","shift","addEventListener","Movable","x","y","vY","vX","collides","pos","Bird","g","force","net","dead","score","dims","Resources","bird","dimensions","pipes","screenWidth","screenHeight","Dimensions","some","pipe","inputs","getHeight","getX","netResult","forward","jump","draw","Math","PI","Pipe","padding","pipeTop","top","bottom","pipeBottom","Flappy","params","birds","maxScore","generation","FPS","pauseWhenHighscore","render","bind","querySelector","target","checked","reset","_loop","e","code","createBirds","getNet","Array","map","max","sort","a","b","best","nextGeneration","NeuralNet","setTimeout","random","Resource","background","files","Object","entries","loadedFiles","loading","load","then","Promise","all","sigmoid","z","exp","MUTATION_CHANCE","MUTATION_FORCE","Neuron","weights","values","reduce","randomize","structure","neurons","result","layer","neuron","file","loaded","img","Image","src","didLoad","res","rej","onload","value","status","onerror","err","angle","warn","_x","_y","save","translate","rotate","drawImage","restore"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/App.ts\");\n","import { createGame } from \"./Game\";\n\ncreateGame();","\nexport enum TextPosition {\n    TopLeft,\n    Middle\n};\n\nexport interface CtxOptions {\n    w?: number,\n    h?: number,\n    size?: number,\n    showFps?: boolean,\n};\n\nexport type RenderFunction = (ctx: CanvasRenderingContext2D) => void;\nexport type RenderTextFunction = () => string;\nexport type RemoveRenderFunction = () => void;\nexport type AliveFunction = () => boolean;\n\nexport default class Ctx {\n    private w: number = 500;\n    private h: number = 500;\n    private size: number = 24; // font size\n\n    private canvas: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n\n    private _queue: {\n        func: RenderFunction,\n        alive: AliveFunction\n    }[] = [];\n\n    private fps: number;\n    private options: CtxOptions = {\n        showFps: false\n    };\n\n    private text: {\n        [position in TextPosition]?: RenderTextFunction[]\n    } = {};\n\n    private textCoordinates: {\n        [position in TextPosition]: () => [number, number, number, number] // w, h, padding-vertical, padding-horizontal\n    } = {\n        [TextPosition.TopLeft]: () => [0, 0, this.size / 2, this.size / 2],\n        [TextPosition.Middle]: () => [this.w / 2, this.h / 2, this.size / 2, 0],\n    };\n\n    constructor(options: CtxOptions = {}) {\n        this.options = options;\n        this.w = options.w || this.w;\n        this.h = options.h || this.h;\n        this.size = options.size || this.size;\n\n        this.options = {...options, ...this.options};\n\n        this.init();\n        this.loop();\n    }\n\n    private init() {\n        this.canvas = document.createElement('canvas');\n        this.canvas.width = this.w;\n        this.canvas.height = this.h;\n\n        this.ctx = document.body.appendChild(this.canvas).getContext('2d');\n        this.ctx.font = `${this.size}px Arial`;\n\n        this.queueText(() => `Fps: ${this.fps.toFixed(1)}`, () => this.options.showFps);\n    }\n\n    private loop(): void {\n        let now;\n        const req = () => requestAnimationFrame(time => {\n            this.fps = 1e3 / (time - now);\n            this.ctx.clearRect(0, 0, this.w, this.h);\n            this._queue.filter(({alive}) => alive())\n                .forEach(({func}) => func(this.ctx));\n\n            now = time;\n            req();\n        });\n        req();\n    }\n\n    public queue(func: RenderFunction, alive: AliveFunction): RemoveRenderFunction {\n        this._queue.push({ func, alive });\n        return () => {\n            const i = this._queue.findIndex(v => v.func == func);\n            if(i == -1)\n                console.error(`Failed to remove render function`, func, alive);\n            else\n                this._queue.splice(i, 1);\n        };\n    }\n\n    public queueText(text: RenderTextFunction, alive: AliveFunction, position: TextPosition = TextPosition.TopLeft): RemoveRenderFunction {\n        if(!this.text[position]) this.text[position] = [];\n        this.text[position].push(text);\n\n        const remove = this.queue(ctx => {\n            const i = this.text[position].findIndex(v => v == text);\n\n            const [w, h, padv, padh] = this.textCoordinates[position]();\n            ctx.fillText(text(), w + padh, h + (i + 1) * (this.size + padv));\n        }, alive);\n\n        return () => {\n            remove();\n        };\n    }\n}","import NeuralNet from \"./NeuralNet\";\nimport Ctx from \"./Ctx\";\nimport { Resources, Dimensions } from './Game';\n\nconst PIPE_GAP = 100;\nconst PIPE_MARGIN = 75;\nconst PIPE_SPEED = -3;\nconst BIRD_AMOUNT = 50;\nconst BIRD_GRAVITY = 0.25;\nconst BIRD_FORCE = -6;\nconst DEFAULT_FPS = 60.0;\n\nconst NETWORK_INPUTS = 3;\nconst NETWORK_OUTPUTS = 1;\nconst NETWORK_STRUCTURE = [NETWORK_INPUTS, 3, NETWORK_OUTPUTS];\n\nexport interface FlappyParams {\n    ctx: Ctx\n};\n\n(function() {\n\tvar timeouts = [];\n\tvar messageName = \"zero-timeout-message\";\n\n\tfunction setZeroTimeout(fn) {\n\t\ttimeouts.push(fn);\n\t\twindow.postMessage(messageName, \"*\");\n\t}\n\n\tfunction handleMessage(event) {\n\t\tif (event.source == window && event.data == messageName) {\n\t\t\tevent.stopPropagation();\n\t\t\tif (timeouts.length > 0) {\n\t\t\t\tvar fn = timeouts.shift();\n\t\t\t\tfn();\n\t\t\t}\n\t\t}\n\t}\n\n\twindow.addEventListener(\"message\", handleMessage, true);\n\n\t(window as any).setZeroTimeout = setZeroTimeout;\n})();\n\nclass Movable {\n    public x: number;\n    public y: number;\n    public w: number;\n    public h: number;\n\n    public vY: number = 0;\n    public vX: number = 0;\n\n    constructor(x, y, w, h) {\n        this.x = x;\n        this.y = y;\n        this.w = w;\n        this.h = h;\n    }\n\n    public loop() {\n        this.y += this.vY;\n        this.x += this.vX;\n    }\n\n    public collides(pos: Movable): boolean {\n        return !(pos.x > this.x + this.w\n            || pos.x + pos.w < this.x\n            || pos.y > this.y + this.h\n            || pos.y + pos.h < this.y);\n    }\n}\n\nclass Bird {\n    private pos: Movable;\n    private force: number;\n    private g: number;\n\n    public net: NeuralNet;\n    public dead: boolean = false;\n    public score: number = 0;\n    \n    constructor(x: number, y: number, g: number, force: number, net: NeuralNet) {\n        const dims = Resources.bird.dimensions();\n        this.pos = new Movable(x, y, dims[0], dims[1]);\n        this.g = g;\n        this.force = force;\n        this.net = net;\n    }\n\n    public loop(pipes: Pipe[]): void {\n        const [screenWidth, screenHeight] = Dimensions;\n\n        if(this.pos.y > screenHeight || this.pos.y < 0) this.dead = true;\n        if(pipes.some(pipe => pipe.collides(this.pos))) this.dead = true;\n\n        if(this.dead) return;\n        this.score++;\n\n        const inputs = [this.pos.y / screenHeight, pipes[0].getHeight() / screenHeight, pipes[0].getX() / screenWidth];\n        // console.log(inputs);\n        const netResult = this.net.forward(inputs);\n        if(netResult[0] > .5) this.jump();\n\n        this.pos.vY += this.g;\n        this.pos.loop();\n    }\n\n    public jump(): void {\n        this.pos.vY = this.force;\n    }\n\n    public draw(ctx: CanvasRenderingContext2D): void {\n        Resources.bird.draw(ctx, this.pos.x, this.pos.y, null, null, Math.PI/2 * this.pos.vY/20);\n    }\n}\n\nclass Pipe {\n    private h: number;\n    private padding: number = PIPE_GAP;\n\n    private top: Movable;\n    private bottom: Movable;\n\n    public dead: boolean = false;\n\n    constructor(x, h, vX) {\n        const dims = Resources.pipeTop.dimensions();\n\n        this.top = new Movable(x, h - dims[1], dims[0], dims[1]);\n        this.bottom = new Movable(x, h + this.padding, dims[0], dims[1]);\n        this.top.vX = vX;\n        this.bottom.vX = vX;\n        this.h = h;\n    }\n\n    public loop() {\n        if(this.top.x + Resources.pipeTop.dimensions()[0] < 0) this.dead = true;\n        this.top.loop();\n        this.bottom.loop();\n    }\n\n    public draw(ctx: CanvasRenderingContext2D) {\n        Resources.pipeTop.draw(ctx, this.top.x, this.h - Resources.pipeTop.dimensions()[1]);\n        Resources.pipeBottom.draw(ctx, this.bottom.x, this.h + this.padding);\n        // ctx.fillRect(this.pos.x, this.h, Resources.pipeTop.dimensions()[0], this.padding);\n    }\n\n    public collides(pos: Movable): boolean {\n        return this.top.collides(pos) || this.bottom.collides(pos);\n    }\n\n    public getHeight(): number {\n        return this.h;\n    }\n\n    public getX(): number {\n        return this.bottom.x;\n    }\n}\n\nexport default class Flappy {\n    private ctx: Ctx;\n\n    private birds: Bird[] = [];\n    private pipes: Pipe[] = [];\n\n    private score: number = 0;\n    private maxScore: number = 0;\n    private generation: number = 1;\n    private FPS: number = DEFAULT_FPS;\n    private pauseWhenHighscore: boolean = false;\n\n    constructor(params: FlappyParams) {\n        this.ctx = params.ctx;\n        this.init();\n    }\n\n    private init(): void {\n        this.ctx.queue(this.render.bind(this), () => true);\n        this.ctx.queueText(() => `Score: ${this.score}`, () => true);\n        this.ctx.queueText(() => `Max score: ${this.maxScore}`, () => true);\n        this.ctx.queueText(() => `Birds: ${this.birds.filter(({ dead }) => !dead).length}/${BIRD_AMOUNT}`, () => true);\n        this.ctx.queueText(() => `Generation: ${this.generation}`, () => true);\n\n        document.addEventListener('keydown', this.event.bind(this));\n        document.querySelector('#speed-normal').addEventListener('click', () => this.FPS = DEFAULT_FPS);\n        document.querySelector('#speed-super').addEventListener('click', () => this.FPS = -1);\n        document.querySelector('#pause').addEventListener('click', ({ target }) => this.pauseWhenHighscore = (target as any).checked);\n        document.querySelector('#respawn').addEventListener('click', () => this.reset());\n\n        this._loop();\n    }\n\n    private event(e: KeyboardEvent) {\n        if(e.code == 'Space') {\n            this.birds[0].jump();\n        }\n    }\n\n    private createBirds(getNet: () => NeuralNet): Bird[] {\n        return [...Array(BIRD_AMOUNT)]\n            .map(() => new Bird(50, Dimensions[1] / 2, BIRD_GRAVITY, BIRD_FORCE, getNet()));\n    }\n\n    private reset(): void {\n        this.pipes = [];\n        this.maxScore = Math.max(this.maxScore, this.score);\n        this.score = 0;\n\n        const birds = this.birds.sort((a, b) => b.score - a.score);\n        const [best] = birds;\n\n        this.birds = this.createBirds(best ? () => best.net.nextGeneration() : () => new NeuralNet(NETWORK_STRUCTURE));\n    }\n\n    private _loop(): void {\n        this.loop();\n        if(this.FPS <= 0) {\n            (window as any).setZeroTimeout(() => {\n                this._loop();\n            });\n        } else {\n            setTimeout(() => {\n                this._loop();\n            }, 1e3/ this.FPS );\n        }\n    }\n\n    private loop(): void {\n        const birds = this.birds.filter(({ dead }) => !dead);\n        this.pipes = this.pipes.filter(({ dead }) => !dead);\n\n        if(birds.length <= 0) {\n            this.generation++;\n            this.reset();\n            return;\n        }\n\n        if(this.pipes.length <= 0)\n            this.pipes = [...Array(1)]\n                .map(() => new Pipe(Dimensions[0], Math.random() * (Dimensions[1] - PIPE_GAP * 2 - PIPE_MARGIN * 2) + PIPE_GAP + PIPE_MARGIN, PIPE_SPEED));\n\n        birds.forEach(bird => bird.loop(this.pipes));\n        this.pipes.forEach(pipe => pipe.loop());\n\n        this.score++;\n        if(this.score > this.maxScore && this.pauseWhenHighscore)\n            this.FPS = DEFAULT_FPS;\n    }\n\n    private render(ctx: CanvasRenderingContext2D) {\n        const dead = ({ dead }) => !dead;\n\n        this.birds.filter(dead).forEach(bird => bird.draw(ctx));\n        this.pipes.filter(dead).forEach(pipe => pipe.draw(ctx));\n    }\n}","import Flappy from \"./Flappy\";\nimport Resource from \"./Resource\";\nimport Ctx, { TextPosition } from \"./Ctx\";\n\nexport const Resources = {\n    pipeBottom: new Resource('./static/pipebottom.png'),\n    pipeTop: new Resource('./static/pipetop.png'),\n    bird: new Resource('./static/bird.png'),\n    background: new Resource('./static/background.png')\n};\n\nexport const Dimensions = [300, 500];\n\nexport const createGame = async () => {\n    const ctx = new Ctx({\n        showFps: true,\n        size: 18,\n        w: Dimensions[0],\n        h: Dimensions[1]\n    });\n\n    const files = Object.entries(Resources);\n    let loadedFiles = 0;\n\n    const loading = files.map(([,v]) => v.load());\n    loading.forEach(v => v.then(() => loadedFiles++));\n\n    const remove = [\n        ctx.queueText(() => `Loading...`, () => true, TextPosition.Middle),\n        ctx.queueText(() => `${loadedFiles}/${files.length}`, () => true, TextPosition.Middle)\n    ]\n\n    await Promise.all(loading);\n    remove.forEach(v => v());\n\n    return new Flappy({\n        ctx\n    });\n}","type NetworkStructure = number[]; // input, hidden[], output\n\n// const sigmoid = z => 1 / (1 + Math.pow(Math.E, -z));\n\nconst random = () => Math.random() * 2 - 1;\nconst sigmoid = z => (1 / (1 + Math.exp((-z)/1)));\n\nconst MUTATION_CHANCE = .2;\nconst MUTATION_FORCE = .1;\n\nclass Neuron {\n    private weights: number[];\n\n    constructor(inputs: number, weights?: number[]) {\n        this.weights = weights || [...Array(inputs)].map(() => random());\n    }\n\n    public forward(values: number[]): number {\n        return sigmoid(\n            values.map((v, i) => this.weights[i] * values[i])\n                .reduce((a, v) => a + v, 0)\n        );\n    }\n\n    public randomize(): Neuron {\n        return new Neuron(null, this.weights.map(v => Math.random() > MUTATION_CHANCE ? v : v + random() * MUTATION_FORCE));\n    }\n}\n\nexport default class NeuralNet {\n    private structure: NetworkStructure;\n    private neurons: Neuron[][];\n\n    constructor(structure: NetworkStructure, neurons?: Neuron[][]) {\n        this.structure = structure;\n        this.neurons = neurons || structure.map((v, i, a) =>\n            [...Array(v)].map(() => new Neuron(i == 0 ? 0 : a[i - 1]))\n        );\n    }\n\n    public forward(values: number[]): number[] {\n        if(values.length != this.neurons[0].length) {\n            console.error('Input length not equal to input neuron layer');\n            return;\n        }\n\n        const result = [...Array(this.neurons.length)];\n        this.neurons.forEach((layer, i) => result[i] = i == 0 ? values : layer.map(neuron => neuron.forward(result[i - 1])));\n\n        // console.log(result);\n        return result[result.length - 1];\n    }\n\n    public nextGeneration(): NeuralNet {\n        return new NeuralNet(this.structure, this.neurons.map(layer => layer.map(neuron => neuron.randomize())));\n    }\n\n    // public breed(a: NeuralNet, b: NeuralNet): NeuralNet {\n    //     return new NeuralNet(this.structure, this.neurons.map(layer => layer.map(neuron => )))\n    // }\n}","import { Dimensions } from \"./Game\";\n\nexport interface LoadStatus {\n    status: string,\n    value?: any\n};\n\nexport default class Resource {\n    private img: HTMLImageElement;\n    private loaded: boolean = false;\n    private didLoad: Promise<LoadStatus>;\n\n    constructor(file: string) {\n        this.init(file);\n    }\n\n    private async init(file: string) {\n        this.img = new Image();\n        this.img.src = file;\n        this.didLoad = new Promise((res, rej) => {\n            this.img.onload = value => res({\n                status: 'success',\n                value\n            });\n            this.img.onerror = err => res({\n                status: 'error',\n                value: err\n            });\n        })\n        await this.didLoad;\n        this.loaded = true;\n    }\n\n    public load(): Promise<LoadStatus> {\n        return this.didLoad;\n    }\n\n    public draw(ctx: CanvasRenderingContext2D, x: number, y: number, w?: number, h?: number, angle?: number) {\n        if(!this.loaded) {\n            console.warn('Image tried to draw when not loaded', this.img.src);\n            return;\n        }\n\n        let _x = x;\n        let _y = y;\n\n        if(angle) {\n            ctx.save();\n            ctx.translate(x + this.img.width / 2, y + this.img.height / 2);\n            ctx.rotate(angle);\n\n            _x = -this.img.width / 2;\n            _y = -this.img.height / 2;\n        }\n\n        if(w && h) ctx.drawImage(this.img, _x, _y, w, h);\n        else ctx.drawImage(this.img, _x, _y);\n\n        if(angle)\n            ctx.restore();\n    }\n\n    public dimensions(): [number, number] {\n        if(!this.loaded) {\n            console.warn('Image tried to get dimensions when not loaded', this.img.src);\n            return;\n        }\n        return [this.img.width, this.img.height];\n    }\n}"],"sourceRoot":""}