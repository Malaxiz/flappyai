{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/js/App.ts","webpack:///./src/js/Ctx.ts","webpack:///./src/js/Flappy.ts","webpack:///./src/js/Game.ts","webpack:///./src/js/NeuralNet.ts","webpack:///./src/js/Resource.ts"],"names":["createGame","TextPosition","RenderPriority","Important","Text","Normal","Ctx","constructor","options","w","h","size","_queue","showFps","text","textCoordinates","TopLeft","Middle","init","loop","canvas","document","createElement","width","height","ctx","body","appendChild","getContext","font","queueText","fps","toFixed","now","req","requestAnimationFrame","time","clearRect","filter","alive","sort","a","b","priority","forEach","func","queue","push","i","findIndex","v","console","error","splice","position","remove","padv","padh","fillText","PIPE_GAP","PIPE_MARGIN","PIPE_SPEED","PIPE_ACCELERATION","BIRD_AMOUNT","BIRD_GRAVITY","BIRD_FORCE","DEFAULT_FPS","NETWORK_INPUTS","NETWORK_OUTPUTS","NETWORK_STRUCTURE","hidden","timeouts","messageName","setZeroTimeout","fn","window","postMessage","handleMessage","event","source","data","stopPropagation","length","shift","addEventListener","Movable","x","y","vY","vX","collides","pos","Bird","g","force","net","dead","score","dims","Resources","bird","dimensions","pipes","screenWidth","screenHeight","Dimensions","some","pipe","inputs","getHeight","getX","netResult","forward","jump","draw","Math","PI","Pipe","padding","pipeTop","top","bottom","pipeBottom","Flappy","params","birds","pipeSpeed","maxScore","generation","FPS","pauseWhenHighscore","desiredStructure","render","bind","querySelector","target","checked","respawn","reset","value","JSON","parse","_loop","e","code","createBirds","amount","getNet","Array","map","max","best","firstGen","NeuralNet","nextGeneration","setTimeout","random","Resource","background","files","Object","entries","loadedFiles","loading","load","then","Promise","all","sigmoid","z","exp","MUTATION_CHANCE","MUTATION_FORCE","Neuron","weights","values","reduce","randomize","structure","neurons","result","layer","neuron","file","loaded","img","Image","src","didLoad","res","rej","onload","status","onerror","err","angle","warn","_x","_y","save","translate","rotate","drawImage","restore"],"mappings":"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","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/App.ts\");\n","import { createGame } from \"./Game\";\n\ncreateGame();","\nexport enum TextPosition {\n    TopLeft,\n    Middle\n};\n\nexport interface CtxOptions {\n    w?: number,\n    h?: number,\n    size?: number,\n    showFps?: boolean,\n};\n\nexport const RenderPriority = {\n    Important: 30,\n    Text: 20,\n    Normal: 10\n};\n\nexport type RenderFunction = (ctx: CanvasRenderingContext2D) => void;\nexport type RenderTextFunction = () => string;\nexport type RemoveRenderFunction = () => void;\nexport type AliveFunction = () => boolean;\n\nexport default class Ctx {\n    private w: number = 500;\n    private h: number = 500;\n    private size: number = 24; // font size\n\n    private canvas: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n\n    private _queue: {\n        func: RenderFunction,\n        alive: AliveFunction,\n        priority?: number\n    }[] = [];\n\n    private fps: number;\n    private options: CtxOptions = {\n        showFps: false\n    };\n\n    private text: {\n        [position in TextPosition]?: RenderTextFunction[]\n    } = {};\n\n    private textCoordinates: {\n        [position in TextPosition]: () => [number, number, number, number] // w, h, padding-vertical, padding-horizontal\n    } = {\n        [TextPosition.TopLeft]: () => [0, 0, this.size / 2, this.size / 2],\n        [TextPosition.Middle]: () => [this.w / 2, this.h / 2, this.size / 2, 0],\n    };\n\n    constructor(options: CtxOptions = {}) {\n        this.options = options;\n        this.w = options.w || this.w;\n        this.h = options.h || this.h;\n        this.size = options.size || this.size;\n\n        this.options = {...options, ...this.options};\n\n        this.init();\n        this.loop();\n    }\n\n    private init() {\n        this.canvas = document.createElement('canvas');\n        this.canvas.width = this.w;\n        this.canvas.height = this.h;\n\n        this.ctx = document.body.appendChild(this.canvas).getContext('2d');\n        this.ctx.font = `${this.size}px Arial`;\n\n        this.queueText(() => `Fps: ${this.fps.toFixed(1)}`, () => this.options.showFps);\n    }\n\n    private loop(): void {\n        let now;\n        const req = () => requestAnimationFrame(time => {\n            this.fps = 1e3 / (time - now);\n            this.ctx.clearRect(0, 0, this.w, this.h);\n            this._queue.filter(({alive}) => alive())\n                .sort((a, b) => +a.priority - +b.priority)\n                .forEach(({func}) => func(this.ctx));\n\n            now = time;\n            req();\n        });\n        req();\n    }\n\n    public queue(func: RenderFunction, alive: AliveFunction, priority: number = RenderPriority.Normal): RemoveRenderFunction {\n        this._queue.push({ func, alive, priority });\n        return () => {\n            const i = this._queue.findIndex(v => v.func == func);\n            if(i == -1)\n                console.error(`Failed to remove render function`, func, alive);\n            else\n                this._queue.splice(i, 1);\n        };\n    }\n\n    public queueText(text: RenderTextFunction, alive: AliveFunction, position: TextPosition = TextPosition.TopLeft): RemoveRenderFunction {\n        if(!this.text[position]) this.text[position] = [];\n        this.text[position].push(text);\n\n        const remove = this.queue(ctx => {\n            const i = this.text[position].findIndex(v => v == text);\n\n            const [w, h, padv, padh] = this.textCoordinates[position]();\n            ctx.fillText(text(), w + padh, h + (i + 1) * (this.size + padv));\n        }, alive, RenderPriority.Text);\n\n        return () => {\n            remove();\n        };\n    }\n}","import NeuralNet from \"./NeuralNet\";\nimport Ctx from \"./Ctx\";\nimport { Resources, Dimensions } from './Game';\n\nconst PIPE_GAP = 100;\nconst PIPE_MARGIN = 0;\nconst PIPE_SPEED = -3;\nconst PIPE_ACCELERATION = -0.01;\nconst BIRD_AMOUNT = 50;\nconst BIRD_GRAVITY = 0.25;\nconst BIRD_FORCE = -6;\nconst DEFAULT_FPS = 60.0;\n\nconst NETWORK_INPUTS = 3;\nconst NETWORK_OUTPUTS = 1;\nconst NETWORK_STRUCTURE = hidden => [NETWORK_INPUTS, ...hidden, NETWORK_OUTPUTS];\n\nexport interface FlappyParams {\n    ctx: Ctx\n};\n\n(function() {\n\tvar timeouts = [];\n\tvar messageName = \"zero-timeout-message\";\n\n\tfunction setZeroTimeout(fn) {\n\t\ttimeouts.push(fn);\n\t\twindow.postMessage(messageName, \"*\");\n\t}\n\n\tfunction handleMessage(event) {\n\t\tif (event.source == window && event.data == messageName) {\n\t\t\tevent.stopPropagation();\n\t\t\tif (timeouts.length > 0) {\n\t\t\t\tvar fn = timeouts.shift();\n\t\t\t\tfn();\n\t\t\t}\n\t\t}\n\t}\n\n\twindow.addEventListener(\"message\", handleMessage, true);\n\n\t(window as any).setZeroTimeout = setZeroTimeout;\n})();\n\nclass Movable {\n    public x: number;\n    public y: number;\n    public w: number;\n    public h: number;\n\n    public vY: number = 0;\n    public vX: number = 0;\n\n    constructor(x, y, w, h) {\n        this.x = x;\n        this.y = y;\n        this.w = w;\n        this.h = h;\n    }\n\n    public loop() {\n        this.y += this.vY;\n        this.x += this.vX;\n    }\n\n    public collides(pos: Movable): boolean {\n        return !(pos.x > this.x + this.w\n            || pos.x + pos.w < this.x\n            || pos.y > this.y + this.h\n            || pos.y + pos.h < this.y);\n    }\n}\n\nclass Bird {\n    private pos: Movable;\n    private force: number;\n    private g: number;\n\n    public net: NeuralNet;\n    public dead: boolean = false;\n    public score: number = 0;\n    \n    constructor(x: number, y: number, g: number, force: number, net: NeuralNet) {\n        const dims = Resources.bird.dimensions();\n        this.pos = new Movable(x, y, dims[0], dims[1]);\n        this.g = g;\n        this.force = force;\n        this.net = net;\n    }\n\n    public loop(pipes: Pipe[]): void {\n        const [screenWidth, screenHeight] = Dimensions;\n\n        if(this.pos.y > screenHeight || this.pos.y < 0) this.dead = true;\n        if(pipes.some(pipe => pipe.collides(this.pos))) this.dead = true;\n\n        if(this.dead) return;\n        this.score++;\n\n        const inputs = [this.pos.y / screenHeight, pipes[0].getHeight() / screenHeight, pipes[0].getX() / screenWidth];\n        // console.log(inputs);\n        const netResult = this.net.forward(inputs);\n        if(netResult[0] > .5) this.jump();\n\n        this.pos.vY += this.g;\n        this.pos.loop();\n    }\n\n    public jump(): void {\n        this.pos.vY = this.force;\n    }\n\n    public draw(ctx: CanvasRenderingContext2D): void {\n        Resources.bird.draw(ctx, this.pos.x, this.pos.y, null, null, Math.PI/2 * this.pos.vY/20);\n    }\n}\n\nclass Pipe {\n    private h: number;\n    private padding: number = PIPE_GAP;\n\n    private top: Movable;\n    private bottom: Movable;\n\n    public dead: boolean = false;\n\n    constructor(x, h, vX) {\n        const dims = Resources.pipeTop.dimensions();\n\n        this.top = new Movable(x, h - dims[1], dims[0], dims[1]);\n        this.bottom = new Movable(x, h + this.padding, dims[0], dims[1]);\n        this.top.vX = vX;\n        this.bottom.vX = vX;\n        this.h = h;\n    }\n\n    public loop() {\n        if(this.top.x + Resources.pipeTop.dimensions()[0] < 0) this.dead = true;\n        this.top.loop();\n        this.bottom.loop();\n    }\n\n    public draw(ctx: CanvasRenderingContext2D) {\n        Resources.pipeTop.draw(ctx, this.top.x, this.h - Resources.pipeTop.dimensions()[1]);\n        Resources.pipeBottom.draw(ctx, this.bottom.x, this.h + this.padding);\n        // ctx.fillRect(this.pos.x, this.h, Resources.pipeTop.dimensions()[0], this.padding);\n    }\n\n    public collides(pos: Movable): boolean {\n        return this.top.collides(pos) || this.bottom.collides(pos);\n    }\n\n    public getHeight(): number {\n        return this.h;\n    }\n\n    public getX(): number {\n        return this.bottom.x;\n    }\n}\n\nexport default class Flappy {\n    private ctx: Ctx;\n\n    private birds: Bird[] = [];\n    private pipes: Pipe[] = [];\n\n    private pipeSpeed = PIPE_SPEED;\n    private score: number = 0;\n    private maxScore: number = 0;\n    private generation: number = 0;\n    private FPS: number = DEFAULT_FPS;\n    private pauseWhenHighscore: boolean = true;\n    private desiredStructure: number[] = [2, 2];\n\n    constructor(params: FlappyParams) {\n        this.ctx = params.ctx;\n        this.init();\n    }\n\n    private init(): void {\n        this.ctx.queue(this.render.bind(this), () => true);\n        this.ctx.queueText(() => `Score: ${this.score}`, () => true);\n        this.ctx.queueText(() => `Max score: ${this.maxScore}`, () => true);\n        this.ctx.queueText(() => `Birds: ${this.birds.filter(({ dead }) => !dead).length}/${BIRD_AMOUNT}`, () => true);\n        this.ctx.queueText(() => `Generation: ${this.generation}`, () => true);\n\n        document.addEventListener('keydown', this.event.bind(this));\n        document.querySelector('#speed-normal').addEventListener('click', () => this.FPS = DEFAULT_FPS);\n        document.querySelector('#speed-super').addEventListener('click', () => this.FPS = -1);\n        document.querySelector('#pause').addEventListener('click', ({ target }) => this.pauseWhenHighscore = (target as any).checked);\n        document.querySelector('#respawn').addEventListener('click', () => this.respawn());\n        document.querySelector('#reset').addEventListener('click', () => this.reset());\n        document.querySelector('#structure').addEventListener('input', ({ target }) => this.desiredStructure = (target as any).value);\n        document.querySelector('#set-structure').addEventListener('click', () => {\n            this.desiredStructure = JSON.parse(`[${this.desiredStructure}]`);\n            this.reset();\n        });\n\n        this._loop();\n    }\n\n    private event(e: KeyboardEvent) {\n        if(e.code == 'Space') {\n            this.birds[0].jump();\n        }\n    }\n\n    private reset(): void {\n        this.pipes = [];\n        this.maxScore = 0;\n        this.score = 0;\n        this.generation = 0;\n        this.birds = [];\n        this.respawn();\n    }\n\n    private createBirds(amount: number, getNet: () => NeuralNet): Bird[] {\n        return [...Array(amount)]\n            .map(() => new Bird(50, Dimensions[1] / 2, BIRD_GRAVITY, BIRD_FORCE, getNet()));\n    }\n\n    private respawn(): void {\n        this.pipeSpeed = PIPE_SPEED;\n        this.pipes = [];\n        this.maxScore = Math.max(this.maxScore, this.score);\n        this.score = 0;\n\n        const birds = this.birds.sort((a, b) => b.score - a.score);\n        const [best] = birds;\n\n        const firstGen = () => new NeuralNet(NETWORK_STRUCTURE(this.desiredStructure));\n\n        if(best) {\n            this.birds = [\n                ...this.createBirds(BIRD_AMOUNT / 2, () => best.net.nextGeneration()),\n                ...this.createBirds(BIRD_AMOUNT / 2, firstGen)\n            ];\n        } else {\n            this.birds = this.createBirds(BIRD_AMOUNT, firstGen);\n        }\n    }\n\n    private _loop(): void {\n        this.loop();\n        if(this.FPS <= 0) {\n            (window as any).setZeroTimeout(() => {\n                this._loop();\n            });\n        } else {\n            setTimeout(() => {\n                this._loop();\n            }, 1e3/ this.FPS );\n        }\n    }\n\n    private loop(): void {\n        const birds = this.birds.filter(({ dead }) => !dead);\n        this.pipes = this.pipes.filter(({ dead }) => !dead);\n\n        if(birds.length <= 0) {\n            this.generation++;\n            this.respawn();\n            return;\n        }\n\n        if(this.pipes.length <= 0) {\n            this.pipeSpeed += PIPE_ACCELERATION;\n            this.pipes = [...Array(1)]\n                .map(() => new Pipe(Dimensions[0], Math.random() * (Dimensions[1] - PIPE_GAP * 2 - PIPE_MARGIN * 2) + PIPE_GAP + PIPE_MARGIN, this.pipeSpeed));\n        }\n\n        birds.forEach(bird => bird.loop(this.pipes));\n        this.pipes.forEach(pipe => pipe.loop());\n\n        this.score++;\n        if(this.score > this.maxScore && this.pauseWhenHighscore)\n            this.FPS = DEFAULT_FPS;\n    }\n\n    private render(ctx: CanvasRenderingContext2D) {\n        const dead = ({ dead }) => !dead;\n\n        this.birds.filter(dead).forEach(bird => bird.draw(ctx));\n        this.pipes.filter(dead).forEach(pipe => pipe.draw(ctx));\n    }\n}","import Flappy from \"./Flappy\";\nimport Resource from \"./Resource\";\nimport Ctx, { TextPosition } from \"./Ctx\";\n\nexport const Resources = {\n    pipeBottom: new Resource('./static/pipebottom.png'),\n    pipeTop: new Resource('./static/pipetop.png'),\n    bird: new Resource('./static/bird.png'),\n    background: new Resource('./static/background.png')\n};\n\nexport const Dimensions = [300, 500];\n\nexport const createGame = async () => {\n    const ctx = new Ctx({\n        showFps: true,\n        size: 18,\n        w: Dimensions[0],\n        h: Dimensions[1]\n    });\n\n    const files = Object.entries(Resources);\n    let loadedFiles = 0;\n\n    const loading = files.map(([,v]) => v.load());\n    loading.forEach(v => v.then(() => loadedFiles++));\n\n    const remove = [\n        ctx.queueText(() => `Loading...`, () => true, TextPosition.Middle),\n        ctx.queueText(() => `${loadedFiles}/${files.length}`, () => true, TextPosition.Middle)\n    ]\n\n    await Promise.all(loading);\n    remove.forEach(v => v());\n\n    return new Flappy({\n        ctx\n    });\n}","type NetworkStructure = number[]; // input, hidden[], output\n\n// const sigmoid = z => 1 / (1 + Math.pow(Math.E, -z));\n\nconst random = () => Math.random() * 2 - 1;\nconst sigmoid = z => (1 / (1 + Math.exp((-z)/1)));\n\nconst MUTATION_CHANCE = .2;\nconst MUTATION_FORCE = .1;\n\nclass Neuron {\n    private weights: number[];\n\n    constructor(inputs: number, weights?: number[]) {\n        this.weights = weights || [...Array(inputs)].map(() => random());\n    }\n\n    public forward(values: number[]): number {\n        return sigmoid(\n            values.map((v, i) => this.weights[i] * values[i])\n                .reduce((a, v) => a + v, 0)\n        );\n    }\n\n    public randomize(): Neuron {\n        return new Neuron(null, this.weights.map(v => Math.random() > MUTATION_CHANCE ? v : v + random() * MUTATION_FORCE));\n    }\n}\n\nexport default class NeuralNet {\n    private structure: NetworkStructure;\n    private neurons: Neuron[][];\n\n    constructor(structure: NetworkStructure, neurons?: Neuron[][]) {\n        this.structure = structure;\n        this.neurons = neurons || structure.map((v, i, a) =>\n            [...Array(v)].map(() => new Neuron(i == 0 ? 0 : a[i - 1]))\n        );\n    }\n\n    public forward(values: number[]): number[] {\n        if(values.length != this.neurons[0].length) {\n            console.error('Input length not equal to input neuron layer');\n            return;\n        }\n\n        const result = [...Array(this.neurons.length)];\n        this.neurons.forEach((layer, i) => result[i] = i == 0 ? values : layer.map(neuron => neuron.forward(result[i - 1])));\n\n        // console.log(result);\n        return result[result.length - 1];\n    }\n\n    public nextGeneration(): NeuralNet {\n        return new NeuralNet(this.structure, this.neurons.map(layer => layer.map(neuron => neuron.randomize())));\n    }\n\n    // public breed(a: NeuralNet, b: NeuralNet): NeuralNet {\n    //     return new NeuralNet(this.structure, this.neurons.map(layer => layer.map(neuron => )))\n    // }\n}","import { Dimensions } from \"./Game\";\n\nexport interface LoadStatus {\n    status: string,\n    value?: any\n};\n\nexport default class Resource {\n    private img: HTMLImageElement;\n    private loaded: boolean = false;\n    private didLoad: Promise<LoadStatus>;\n\n    constructor(file: string) {\n        this.init(file);\n    }\n\n    private async init(file: string) {\n        this.img = new Image();\n        this.img.src = file;\n        this.didLoad = new Promise((res, rej) => {\n            this.img.onload = value => res({\n                status: 'success',\n                value\n            });\n            this.img.onerror = err => res({\n                status: 'error',\n                value: err\n            });\n        })\n        await this.didLoad;\n        this.loaded = true;\n    }\n\n    public load(): Promise<LoadStatus> {\n        return this.didLoad;\n    }\n\n    public draw(ctx: CanvasRenderingContext2D, x: number, y: number, w?: number, h?: number, angle?: number) {\n        if(!this.loaded) {\n            console.warn('Image tried to draw when not loaded', this.img.src);\n            return;\n        }\n\n        let _x = x;\n        let _y = y;\n\n        if(angle) {\n            ctx.save();\n            ctx.translate(x + this.img.width / 2, y + this.img.height / 2);\n            ctx.rotate(angle);\n\n            _x = -this.img.width / 2;\n            _y = -this.img.height / 2;\n        }\n\n        if(w && h) ctx.drawImage(this.img, _x, _y, w, h);\n        else ctx.drawImage(this.img, _x, _y);\n\n        if(angle)\n            ctx.restore();\n    }\n\n    public dimensions(): [number, number] {\n        if(!this.loaded) {\n            console.warn('Image tried to get dimensions when not loaded', this.img.src);\n            return;\n        }\n        return [this.img.width, this.img.height];\n    }\n}"],"sourceRoot":""}