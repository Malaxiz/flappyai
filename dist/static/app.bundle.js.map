{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/js/App.ts","webpack:///./src/js/Ctx.ts","webpack:///./src/js/Flappy.ts","webpack:///./src/js/Game.ts","webpack:///./src/js/NeuralNet.ts","webpack:///./src/js/Resource.ts"],"names":["createGame","TextPosition","Ctx","constructor","options","w","h","size","_queue","showFps","text","textCoordinates","TopLeft","Middle","init","loop","canvas","document","createElement","width","height","ctx","body","appendChild","getContext","font","queueText","fps","toFixed","now","req","requestAnimationFrame","time","clearRect","filter","alive","forEach","func","queue","push","i","findIndex","v","console","error","splice","position","remove","padv","padh","fillText","Flappy","params","log","resources","pipeBottom","Resource","pipeTop","bird","background","files","Object","entries","loadedFiles","loading","map","load","then","catch","length","Promise","all","net","NeuralNet","file","loaded","img","Image","src","didLoad","res","rej","onload","value","status","onerror","err"],"mappings":";QAAA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;;QAEA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;;;QAGA;QACA;;QAEA;QACA;;QAEA;QACA;QACA;QACA,0CAA0C,gCAAgC;QAC1E;QACA;;QAEA;QACA;QACA;QACA,wDAAwD,kBAAkB;QAC1E;QACA,iDAAiD,cAAc;QAC/D;;QAEA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA;QACA,yCAAyC,iCAAiC;QAC1E,gHAAgH,mBAAmB,EAAE;QACrI;QACA;;QAEA;QACA;QACA;QACA,2BAA2B,0BAA0B,EAAE;QACvD,iCAAiC,eAAe;QAChD;QACA;QACA;;QAEA;QACA,sDAAsD,+DAA+D;;QAErH;QACA;;;QAGA;QACA;;;;;;;;;;;;;AClFA;AAAA;AAAA;AAEAA,wDAAU,G;;;;;;;;;;;;ACDV;AAAA;AAAA;AAAO,IAAKC,YAAZ;;WAAYA,Y;AAAAA,c,CAAAA,Y;AAAAA,c,CAAAA,Y;GAAAA,Y,KAAAA,Y;;AAGX;AAOA;AAOc,MAAMC,GAAN,CAAU;AAGM;AA0B3BC,aAAW,CAACC,OAAmB,GAAG,EAAvB,EAA2B;AAAA,SA5B9BC,CA4B8B,GA5BlB,GA4BkB;AAAA,SA3B9BC,CA2B8B,GA3BlB,GA2BkB;AAAA,SA1B9BC,IA0B8B,GA1Bf,EA0Be;AAAA,SArB9BC,MAqB8B,GAlBhC,EAkBgC;AAAA,SAf9BJ,OAe8B,GAfR;AAC1BK,aAAO,EAAE;AADiB,KAeQ;AAAA,SAX9BC,IAW8B,GATlC,EASkC;AAAA,SAP9BC,eAO8B,GALlC;AACA,OAACV,YAAY,CAACW,OAAd,GAAwB,MAAM,CAAC,CAAD,EAAI,CAAJ,EAAO,KAAKL,IAAL,GAAY,CAAnB,EAAsB,KAAKA,IAAL,GAAY,CAAlC,CAD9B;AAEA,OAACN,YAAY,CAACY,MAAd,GAAuB,MAAM,CAAC,KAAKR,CAAL,GAAS,CAAV,EAAa,KAAKC,CAAL,GAAS,CAAtB,EAAyB,KAAKC,IAAL,GAAY,CAArC,EAAwC,CAAxC;AAF7B,KAKkC;AAClC,SAAKH,OAAL,GAAeA,OAAf;AACA,SAAKC,CAAL,GAASD,OAAO,CAACC,CAAR,IAAa,KAAKA,CAA3B;AACA,SAAKC,CAAL,GAASF,OAAO,CAACE,CAAR,IAAa,KAAKA,CAA3B;AACA,SAAKC,IAAL,GAAYH,OAAO,CAACG,IAAR,IAAgB,KAAKA,IAAjC;AAEA,SAAKH,OAAL,GAAe,EAAC,GAAGA,OAAJ;AAAa,SAAG,KAAKA;AAArB,KAAf;AAEA,SAAKU,IAAL;AACA,SAAKC,IAAL;AACH;;AAEOD,MAAR,GAAe;AACX,SAAKE,MAAL,GAAcC,QAAQ,CAACC,aAAT,CAAuB,QAAvB,CAAd;AACA,SAAKF,MAAL,CAAYG,KAAZ,GAAoB,KAAKd,CAAzB;AACA,SAAKW,MAAL,CAAYI,MAAZ,GAAqB,KAAKd,CAA1B;AAEA,SAAKe,GAAL,GAAWJ,QAAQ,CAACK,IAAT,CAAcC,WAAd,CAA0B,KAAKP,MAA/B,EAAuCQ,UAAvC,CAAkD,IAAlD,CAAX;AACA,SAAKH,GAAL,CAASI,IAAT,GAAiB,GAAE,KAAKlB,IAAK,UAA7B;AAEA,SAAKmB,SAAL,CAAe,MAAO,QAAO,KAAKC,GAAL,CAASC,OAAT,CAAiB,CAAjB,CAAoB,EAAjD,EAAoD,MAAM,KAAKxB,OAAL,CAAaK,OAAvE;AACH;;AAEOM,MAAR,GAAqB;AACjB,QAAIc,GAAJ;;AACA,UAAMC,GAAG,GAAG,MAAMC,qBAAqB,CAACC,IAAI,IAAI;AAC5C,WAAKL,GAAL,GAAW,OAAOK,IAAI,GAAGH,GAAd,CAAX;AACA,WAAKR,GAAL,CAASY,SAAT,CAAmB,CAAnB,EAAsB,CAAtB,EAAyB,KAAK5B,CAA9B,EAAiC,KAAKC,CAAtC;;AACA,WAAKE,MAAL,CAAY0B,MAAZ,CAAmB,CAAC;AAACC;AAAD,OAAD,KAAaA,KAAK,EAArC,EACKC,OADL,CACa,CAAC;AAACC;AAAD,OAAD,KAAYA,IAAI,CAAC,KAAKhB,GAAN,CAD7B;;AAGAQ,SAAG,GAAGG,IAAN;AACAF,SAAG;AACN,KARsC,CAAvC;;AASAA,OAAG;AACN;;AAEMQ,OAAP,CAAaD,IAAb,EAAmCF,KAAnC,EAA+E;AAC3E,SAAK3B,MAAL,CAAY+B,IAAZ,CAAiB;AAAEF,UAAF;AAAQF;AAAR,KAAjB;;AACA,WAAO,MAAM;AACT,YAAMK,CAAC,GAAG,KAAKhC,MAAL,CAAYiC,SAAZ,CAAsBC,CAAC,IAAIA,CAAC,CAACL,IAAF,IAAUA,IAArC,CAAV;;AACA,UAAGG,CAAC,IAAI,CAAC,CAAT,EACIG,OAAO,CAACC,KAAR,CAAe,kCAAf,EAAkDP,IAAlD,EAAwDF,KAAxD,EADJ,KAGI,KAAK3B,MAAL,CAAYqC,MAAZ,CAAmBL,CAAnB,EAAsB,CAAtB;AACP,KAND;AAOH;;AAEMd,WAAP,CAAiBhB,IAAjB,EAA2CyB,KAA3C,EAAiEW,QAAsB,GAAG7C,YAAY,CAACW,OAAvG,EAAsI;AAClI,QAAG,CAAC,KAAKF,IAAL,CAAUoC,QAAV,CAAJ,EAAyB,KAAKpC,IAAL,CAAUoC,QAAV,IAAsB,EAAtB;AACzB,SAAKpC,IAAL,CAAUoC,QAAV,EAAoBP,IAApB,CAAyB7B,IAAzB;AAEA,UAAMqC,MAAM,GAAG,KAAKT,KAAL,CAAWjB,GAAG,IAAI;AAC7B,YAAMmB,CAAC,GAAG,KAAK9B,IAAL,CAAUoC,QAAV,EAAoBL,SAApB,CAA8BC,CAAC,IAAIA,CAAC,IAAIhC,IAAxC,CAAV;AAEA,YAAM,CAACL,CAAD,EAAIC,CAAJ,EAAO0C,IAAP,EAAaC,IAAb,IAAqB,KAAKtC,eAAL,CAAqBmC,QAArB,GAA3B;AACAzB,SAAG,CAAC6B,QAAJ,CAAaxC,IAAI,EAAjB,EAAqBL,CAAC,GAAG4C,IAAzB,EAA+B3C,CAAC,GAAG,CAACkC,CAAC,GAAG,CAAL,KAAW,KAAKjC,IAAL,GAAYyC,IAAvB,CAAnC;AACH,KALc,EAKZb,KALY,CAAf;AAOA,WAAO,MAAM;AACTY,YAAM;AACT,KAFD;AAGH;;AA3FoB,C;;;;;;;;;;;;ACLxB;AAAA;AAAA;AAEc,MAAMI,MAAN,CAAa;AAQxBhD,aAAW,CAACiD,MAAD,EAAuB;AAC9BT,WAAO,CAACU,GAAR,CAAYD,MAAZ;AACH;;AAVuB,C;;;;;;;;;;;;ACf5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEO,MAAMpD,UAAU,GAAG,YAAY;AAClC,QAAMqB,GAAG,GAAG,IAAInB,4CAAJ,CAAQ;AAChBO,WAAO,EAAE;AADO,GAAR,CAAZ;AAIA,QAAM6C,SAAS,GAAG;AACdC,cAAU,EAAE,IAAIC,iDAAJ,CAAa,yBAAb,CADE;AAEdC,WAAO,EAAE,IAAID,iDAAJ,CAAa,sBAAb,CAFK;AAGdE,QAAI,EAAE,IAAIF,iDAAJ,CAAa,mBAAb,CAHQ;AAIdG,cAAU,EAAE,IAAIH,iDAAJ,CAAa,yBAAb;AAJE,GAAlB;AAOA,QAAMI,KAAK,GAAGC,MAAM,CAACC,OAAP,CAAeR,SAAf,CAAd;AACA,MAAIS,WAAW,GAAG,CAAlB;AAEA,QAAMC,OAAO,GAAGJ,KAAK,CAACK,GAAN,CAAU,CAAC,GAAEvB,CAAF,CAAD,KAAUA,CAAC,CAACwB,IAAF,EAApB,CAAhB;AACAF,SAAO,CAAC5B,OAAR,CAAgBM,CAAC,IAAIA,CAAC,CAACyB,IAAF,CAAO,MAAMJ,WAAW,EAAxB,EAA4BK,KAA5B,CAAkC,MAAML,WAAW,EAAnD,CAArB;AAEA,QAAMhB,MAAM,GAAG,CACX1B,GAAG,CAACK,SAAJ,CAAc,MAAO,YAArB,EAAkC,MAAM,IAAxC,EAA8CzB,iDAAY,CAACY,MAA3D,CADW,EAEXQ,GAAG,CAACK,SAAJ,CAAc,MAAO,GAAEqC,WAAY,IAAGH,KAAK,CAACS,MAAO,EAAnD,EAAsD,MAAM,IAA5D,EAAkEpE,iDAAY,CAACY,MAA/E,CAFW,CAAf;AAKA,QAAMyD,OAAO,CAACC,GAAR,CAAYP,OAAZ,CAAN;AAEAjB,QAAM,CAACX,OAAP,CAAeM,CAAC,IAAIA,CAAC,EAArB;AAEA,SAAO,IAAIS,+CAAJ,CAAW;AACdqB,OAAG,EAAE,IAAIC,kDAAJ,EADS;AAEdpD,OAFc;AAGdiC;AAHc,GAAX,CAAP;AAKH,CAhCM,C;;;;;;;;;;;;ACHP;AAAA;AAAe,MAAMmB,SAAN,CAAgB,E;;;;;;;;;;;;ACC9B;AAAA;AAAA;AAEc,MAAMjB,QAAN,CAAe;AAK1BrD,aAAW,CAACuE,IAAD,EAAe;AAAA,SAHlBC,MAGkB,GAHA,KAGA;AACtB,SAAK7D,IAAL,CAAU4D,IAAV;AACH;;AAED,QAAc5D,IAAd,CAAmB4D,IAAnB,EAAiC;AAC7B,SAAKE,GAAL,GAAW,IAAIC,KAAJ,EAAX;AACA,SAAKD,GAAL,CAASE,GAAT,GAAeJ,IAAf;AACA,SAAKK,OAAL,GAAe,IAAIT,OAAJ,CAAY,CAACU,GAAD,EAAMC,GAAN,KAAc;AACrC,WAAKL,GAAL,CAASM,MAAT,GAAkBC,KAAK,IAAIH,GAAG,CAAC;AAC3BI,cAAM,EAAE,SADmB;AAE3BD;AAF2B,OAAD,CAA9B;;AAIA,WAAKP,GAAL,CAASS,OAAT,GAAmBC,GAAG,IAAIN,GAAG,CAAC;AAC1BI,cAAM,EAAE,OADkB;AAE1BD,aAAK,EAAEG;AAFmB,OAAD,CAA7B;AAIH,KATc,CAAf;AAUA,UAAM,KAAKP,OAAX;AACA,SAAKJ,MAAL,GAAc,IAAd;AACH;;AAEMT,MAAP,GAAmC;AAC/B,WAAO,KAAKa,OAAZ;AACH;;AA5ByB,C","file":"app.bundle.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./src/js/App.ts\");\n","import { createGame } from \"./Game\";\n\ncreateGame();","\nexport enum TextPosition {\n    TopLeft,\n    Middle\n};\n\nexport interface CtxOptions {\n    w?: number,\n    h?: number,\n    size?: number,\n    showFps?: boolean,\n};\n\nexport type RenderFunction = (ctx: CanvasRenderingContext2D) => void;\nexport type RenderTextFunction = () => string;\nexport type RemoveRenderFunction = () => void;\nexport type AliveFunction = () => boolean;\n\nexport default class Ctx {\n    private w: number = 500;\n    private h: number = 500;\n    private size: number = 24; // font size\n\n    private canvas: HTMLCanvasElement;\n    private ctx: CanvasRenderingContext2D;\n\n    private _queue: {\n        func: RenderFunction,\n        alive: AliveFunction\n    }[] = [];\n\n    private fps: number;\n    private options: CtxOptions = {\n        showFps: false\n    };\n\n    private text: {\n        [position in TextPosition]?: RenderTextFunction[]\n    } = {};\n\n    private textCoordinates: {\n        [position in TextPosition]: () => [number, number, number, number] // w, h, padding-vertical, padding-horizontal\n    } = {\n        [TextPosition.TopLeft]: () => [0, 0, this.size / 2, this.size / 2],\n        [TextPosition.Middle]: () => [this.w / 2, this.h / 2, this.size / 2, 0],\n    };\n\n    constructor(options: CtxOptions = {}) {\n        this.options = options;\n        this.w = options.w || this.w;\n        this.h = options.h || this.h;\n        this.size = options.size || this.size;\n\n        this.options = {...options, ...this.options};\n\n        this.init();\n        this.loop();\n    }\n\n    private init() {\n        this.canvas = document.createElement('canvas');\n        this.canvas.width = this.w;\n        this.canvas.height = this.h;\n\n        this.ctx = document.body.appendChild(this.canvas).getContext('2d');\n        this.ctx.font = `${this.size}px Arial`;\n\n        this.queueText(() => `Fps: ${this.fps.toFixed(1)}`, () => this.options.showFps);\n    }\n\n    private loop(): void {\n        let now;\n        const req = () => requestAnimationFrame(time => {\n            this.fps = 1e3 / (time - now);\n            this.ctx.clearRect(0, 0, this.w, this.h);\n            this._queue.filter(({alive}) => alive())\n                .forEach(({func}) => func(this.ctx));\n\n            now = time;\n            req();\n        });\n        req();\n    }\n\n    public queue(func: RenderFunction, alive: AliveFunction): RemoveRenderFunction {\n        this._queue.push({ func, alive });\n        return () => {\n            const i = this._queue.findIndex(v => v.func == func);\n            if(i == -1)\n                console.error(`Failed to remove render function`, func, alive);\n            else\n                this._queue.splice(i, 1);\n        };\n    }\n\n    public queueText(text: RenderTextFunction, alive: AliveFunction, position: TextPosition = TextPosition.TopLeft): RemoveRenderFunction {\n        if(!this.text[position]) this.text[position] = [];\n        this.text[position].push(text);\n\n        const remove = this.queue(ctx => {\n            const i = this.text[position].findIndex(v => v == text);\n\n            const [w, h, padv, padh] = this.textCoordinates[position]();\n            ctx.fillText(text(), w + padh, h + (i + 1) * (this.size + padv));\n        }, alive);\n\n        return () => {\n            remove();\n        };\n    }\n}","import NeuralNet from \"./NeuralNet\";\nimport Resource from \"./Resource\";\nimport Ctx from \"./Ctx\";\n\nexport interface FlappyParams {\n    net: NeuralNet,\n    ctx: Ctx,\n    resources: {\n        pipeBottom: Resource,\n        pipeTop: Resource,\n        bird: Resource,\n        background: Resource\n    }\n};\n\nexport default class Flappy {\n    private ctx: Ctx;\n    private net: NeuralNet;\n\n    private resources: {\n        [key: string]: Resource\n    };\n\n    constructor(params: FlappyParams) {\n        console.log(params);\n    }\n}","import Flappy from \"./Flappy\";\nimport NeuralNet from \"./NeuralNet\";\nimport Resource from \"./Resource\";\nimport Ctx, { TextPosition } from \"./Ctx\";\n\nexport const createGame = async () => {\n    const ctx = new Ctx({\n        showFps: true\n    });\n\n    const resources = {\n        pipeBottom: new Resource('./static/pipebottom.png'),\n        pipeTop: new Resource('./static/pipetop.png'),\n        bird: new Resource('./static/bird.png'),\n        background: new Resource('./static/background.png')\n    };\n    \n    const files = Object.entries(resources);\n    let loadedFiles = 0;\n\n    const loading = files.map(([,v]) => v.load());\n    loading.forEach(v => v.then(() => loadedFiles++).catch(() => loadedFiles++));\n\n    const remove = [\n        ctx.queueText(() => `Loading...`, () => true, TextPosition.Middle),\n        ctx.queueText(() => `${loadedFiles}/${files.length}`, () => true, TextPosition.Middle)\n    ]\n\n    await Promise.all(loading);\n\n    remove.forEach(v => v());\n\n    return new Flappy({\n        net: new NeuralNet(),\n        ctx,\n        resources\n    });\n}","\n\nexport default class NeuralNet {\n    \n}","export interface LoadStatus {\n    status: string,\n    value?: any\n};\n\nexport default class Resource {\n    private img: HTMLImageElement;\n    private loaded: boolean = false;\n    private didLoad: Promise<LoadStatus>;\n\n    constructor(file: string) {\n        this.init(file);\n    }\n\n    private async init(file: string) {\n        this.img = new Image();\n        this.img.src = file;\n        this.didLoad = new Promise((res, rej) => {\n            this.img.onload = value => res({\n                status: 'success',\n                value\n            });\n            this.img.onerror = err => res({\n                status: 'error',\n                value: err\n            });\n        })\n        await this.didLoad;\n        this.loaded = true;\n    }\n\n    public load(): Promise<LoadStatus> {\n        return this.didLoad;\n    }\n}"],"sourceRoot":""}